<?php 
/**
 * Request_Rma extension
 * Rma view template
 *
 * @category	Request
 * @package		Request_Rma
 * @author      Tosif Qureshi
 */
?>
<?php
/* Get rma post details */ 
$_rma_data = $this->getCurrentRmaData();
/* Get product data */
$_product_data = $this->getProductData();
/* Get order data */
$_order_data = $this->getOrderDetails();
/* Get rma reason records */
$_reason_data = $this->getRmaReasons();
/* Get invoice number records of order */
$_invoice_data = Mage::helper('rma/request')->getInvoiceNumbers($this->getOrderId());
/* Get product quantity of order */
$_product_quantity =  Mage::helper('rma/request')->getProductQuantity($_product_data['product_id']);

?>
<div class="block block-subscribe">
	<?php if($this->getIsSkuExist()) : ?>
	<div class="block-title">
		<strong><span><?php echo $this->getRmaTypeTitle();?></span></strong>
    </div>
	<!-- Rma form to report complaint or return request-->
	<form id="rma_report_form" name="rma_report_form" action="<?php echo $this->getUrl('rma/request/');?>save" method="post">
		 <div class="block-content">
			<!-- Product name based on sku number --> 
			<div class="form-subscribe-header formLabelTxt">
				<label for="name"><?php echo $this->__('Product Name');?><span></span></label>
			</div>
			<div class="input-box">
				<?php echo $_product_data['product_name'];?>
			</div>
			<div class="clear"></div>
			
			<!-- Quantity text field of report-->
			<div class="form-subscribe-header formLabelTxt">
				<label for="name"><?php echo $this->__('Quantity');?><span></span></label>
			</div>
			<!-- Product quantity selectbox of rma -->
			<select name="quantity" id="quantity" class="minWidth130">
				<!--<option value=""><?php //echo $this->__('Select product quantity');?></option>-->
				<?php
				 for($i=1;$i<=$_product_quantity;$i++) : ?>
					<option value="<?php echo $i;?>"><?php echo $i;?></option>
				<?php endfor; ?>
			</select>
			<div class="clear"></div>
			
			<!-- Invoice number text field of report-->
			<div class="form-subscribe-header formLabelTxt">
				<label for="name"><?php echo $this->__('Invoice Number');?><span></span></label>
			</div>
			<!-- Invoice number selectbox of rma -->
			<select name="invoice_number">
				<option value=""><?php echo $this->getInvoiceOptLbl(count($_invoice_data));?></option>
				<?php
				 foreach($_invoice_data as $invoice) : ?>
					<option value="<?php echo $invoice['id'];?>"><?php echo $invoice['name'];?></option>
				<?php endforeach; ?>
			</select>
			<div class="clear"></div>
			
			<!-- Reason type of RMA -->
			<div class="form-subscribe-header formLabelTxt">
				<label for="name"><?php echo $this->__('Reason');?><span></span></label>
			    <label class="requireTxt"><?php echo $this->__('*') ?></label>
			</div>
			<!-- Reason selectbox of rma -->
			<select name="reason_id" id="reason_id" class="required-entry reasonSelect">
				<option value=""><?php echo $this->__('Select your reason');?></option>
				<?php
				 foreach($_reason_data as $reason) : 
					if($reason->getIs_active()==1) : ?>
						<option value="<?php echo $reason->getId();?>"><?php echo $reason->getReason();?></option>
					<?php
					endif;
				  endforeach; ?>
			</select>
			<div class="clear"></div>
			
			<div id="reasonDiv" class="width608px">
				<div class="fl width108px">
					<!-- Serial number text field of report-->
					<div class="form-subscribe-header formLabelTxt">
						<label for="name"><?php echo $this->__('Serial Number');?><span></span></label>
						<label class="requireTxt"><?php echo $this->__('*') ?></label>
					</div>
					<div class="input-box">
						<div id="serailDiv">
							<div class="serialRow">
								<input name="serial_number[]" id="serial_number" title="Serial Number" value="" type="text" class="required-entry validate-number width108px">
							</div>
							<span class="serailClass"></span>
						</div>
					</div>
				</div>
				<div class="fl ml25">
					<!-- Error description textarea field of report-->
					<div class="form-subscribe-header formLabelTxt">
						<label for="name"><?php echo $this->__('Error description');?><span></span></label>
					</div>
					<div class="input-box">
						<textarea class="reasonTextarea" name="error_description[]" id="error_description" title="Error description" value=""></textarea>
					</div>
				</div>
			</div>
			<div class="clear"></div>
			<div class="reasonDescDiv width608px"></div>
			<div class="clear"></div>
			
			<!-- Set hidden value of report type -->
			<input name="rma_type" value="<?php echo $_rma_data['rma_type'];?>" type="hidden">
			<!-- Set hidden value of product id -->
			<input name="product_id" value="<?php echo $_product_data['product_id'];?>" type="hidden">
			<!-- Set hidden value of sku number -->
			<input name="sku_number" value="<?php echo $_rma_data['sku_number'];?>" type="hidden">
			<!-- Set hidden value of order id -->
			<input name="order_id" value="<?php echo $this->getOrderId();?>" type="hidden">
			<!-- Set hidden value of rma id -->
			<input name="rma_id" value="<?php echo $this->getRmaId();?>" type="hidden">
			
			
			<!-- Div start here of submit button -->
			<div class="actions">
				<!--<p>* Required Fields</p>-->
				<button type="submit" class="button">
					<p class="required"><?php echo $this->__('* Required Fields') ?></p>
					<span><?php echo $this->__('Submit');?></span>
				</button>	
			</div>
			<!-- Div end here of submit button -->
		</div> 
	</form>
	<?php endif;?>
</div>
<!-- Div start here for back url -->
<div class="buttons-set">
	<p class="back-link"><a href="<?php echo $this->getRmaBackUrl() ?>"><small>&laquo; </small><?php echo $this->getBackTitle() ?></a></p>
</div>

<script type="text/javascript">
	
	//<![CDATA[
        var rmaReportFormDetail = new VarienForm('rma_report_form');
    //]]>
	
	/**
    * manage reason fields as quantity selection
    */
    jQuery(document).ready(function() {
		 jQuery('select[name="quantity"]').change(function() {
			 /* get selected sku number value */
			 var quantity = jQuery('#quantity').val();
			 
			 if(quantity!='') {
				jQuery('.reasonDescDiv').html('');
				/* Create html value here */
				var htmlContent = '';
				for(i=1;i<quantity;i++) {
					htmlContent += addReasonRow(i);
				}
			jQuery('.reasonDescDiv').html(htmlContent);
			}
		});
	});
	
</script>

